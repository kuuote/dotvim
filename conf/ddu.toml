[[plugins]]
repo = '4513echo/ddu-source-source'
lua_add = '''
local c = require('vimrc.command').define
c('DduSourceSource', function()
  require('ddu').start { 'source' }
end)
'''

[[plugins]]
repo = 'Shougo/ddu-kind-file'

[[plugins]]
repo = 'Shougo/ddu-kind-word'

[[plugins]]
repo = 'Shougo/ddu-source-file'

[[plugins]]
repo = 'Shougo/ddu-source-file_rec'
lua_add = '''
require('vimrc.map').define('n', '<C-p>', function()
  local path = vim.fn.expand('%:p')
  if path == '' then
    path = vim.fn.getcwd()
  elseif vim.fn.isdirectory(path) == 0 then
    path = vim.fn.expand('%:p:h')
  end
  require('ddu').start {
    'file_rec',
    sourceOptions = {
      file_rec = {
        path = path,
      },
    },
  }
end)
'''

[[plugins]]
repo = 'Shougo/ddu-source-line'

[[plugins]]
repo = 'Shougo/ddu-ui-ff'
lua_add = '''
local au = require('vimrc.autocmd').define
local fn = require('vimrc.convert').fn
local m = require('vimrc.map').define
local part = require('kutil.function').partition_keyvalue
local cmd = vim.cmd or vim.command

local do_action = fn['ddu#ui#ff#do_action']

local function action(name)
  return function()
    do_action(name)
  end
end

local function item_action(tbl)
  local args, params = part(tbl)
  local farg = {
    action = args[1],
    params = params,
  }
  return function()
    do_action('itemAction', farg)
  end
end

au('FileType', {
  pattern = 'ddu-ff',
  callback = function()
    local opts = {
      buffer = true,
      nowait = true,
    }
    m('n', '<CR>', action('itemAction'), opts)
    m('n', '<Space>', action('toggleSelectItem'), opts)
    m('n', 'i', action('openFilterWindow'), opts)
    m('n', 'p', action('preview'), opts)
    m('n', 'q', action('quit'), opts)
    if vim.b.ddu_ui_name == 'file' then
      m('n', 't', item_action { 'open', command = 'tabedit' }, opts)
      m('n', 's', item_action { 'open', command = 'split' }, opts)
      m('n', 'v', item_action { 'open', command = 'vsplit' }, opts)
    end
  end,
})

au('FileType', {
  pattern = 'ddu-ff-filter',
  callback = function()
    local opts = {
    buffer = true,
    nowait = true,
    }
    m({'n', 'i'}, '<CR>', function()
      cmd('stopinsert')
      vim.call('ddu#ui#ff#close')
    end, opts)
    m('i', '<C-j>', function()
      vim.call('ddu#ui#ff#execute', [[call cursor(line('.')+1, 0)]])
      cmd('redraw!')
    end, opts)
    m('i', '<C-k>', function()
      vim.call('ddu#ui#ff#execute', [[call cursor(line('.')-1, 0)]])
      cmd('redraw!')
    end, opts)
    -- for fzf and jis keyboard
    m('i', ':', [[']], {buffer=true})
  end,
})
'''

[[plugins]]
repo = 'Shougo/ddu.vim'
hook_source = '''
source ~/.vim/conf/plug/ddu.vim
'''

[[plugins]]
repo = 'kuuote/ddu-filter-fuse'

[[plugins]]
repo = 'kuuote/ddu-source-mr'
lua_add = '''
local m = require('vimrc.map').define

for _, t in ipairs { 'mru', 'mrw', 'mrr' } do
  m('n', t, function()
    require('ddu').start {
      { name = 'mr', params = { kind = t } },
      name = 'file',
    }
  end)
end
'''

[[plugins]]
repo = 'matsui54/ddu-source-dein_update'
lua_add = '''
local c = require('vimrc.command').define
c('DduDeinUpdate', function()
  require('ddu').start { 'dein_update', name = 'dein_update' }
end)
'''

[[plugins]]
repo = 'matsui54/ddu-source-help'
lua_add = '''
require('vimrc.map').define('n', 'H', function()
  require('ddu').start { 'help' }
end)
'''

[[plugins]]
repo = 'shun/ddu-rg'
lua_add = '''
local c = require('vimrc.command').define
c('DduRgLive', function()
  require('ddu').start {
    {
      name = 'rg',
      options = {
        matchers = {},
      },
    },
    uiParams = {
      ff = {
        ignoreEmpty = false,
        autoResize = false,
      },
    },
  }
end)
'''
hook_add = '''
" from help
command! DduRgLive call <SID>ddu_rg_live()
function! s:ddu_rg_live() abort
  call ddu#start({
        \   'volatile': v:true,
        \   'sources': [{
        \     'name': 'rg',
        \     'options': {'matchers': []},
        \   }],
        \   'uiParams': {'ff': {
        \     'ignoreEmpty': v:false,
        \     'autoResize': v:false,
        \   }},
        \ })
endfunction
'''

[[plugins]]
repo = 'yuki-yano/ddu-filter-fzf'
